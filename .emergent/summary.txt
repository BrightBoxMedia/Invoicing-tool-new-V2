<analysis>
The AI engineer's work primarily focused on iteratively enhancing an enterprise invoice and project management tool. Key areas included: fixing UI/UX issues, implementing real-time updates via WebSockets, overhauling project creation with a Super Intelligent BOQ Parser for diverse Excel formats, and streamlining multi-step forms. Recurring efforts involved addressing modal layering (Z-index), ensuring data consistency, and refining user experience based on feedback. Significant work was dedicated to developing a comprehensive GST management workflow (selection, approval, locking) and a robust invoice amendment feature. The process involved extensive frontend and backend modifications, debugging BOQ parsing, fixing API routing, and resolving UI rendering errors. The engineer consistently aimed for a 100% success rate and production readiness, addressing issues such as  serialization and missing backend endpoints. The latest task involves a pixel-perfect invoice design.
</analysis>

<product_requirements>
The application is an enterprise invoice and project management tool for Activus Design & Build, aiming for Refrens.com-like UI/UX. It supports BOQ upload, GST-compliant invoice generation (including partial billing), multi-role user management, dynamic PDF generation, Item Master, Smart Filters/Search, Reports, Bank Guarantees, and a PDF Text Extraction Engine.

Recent implementations include:
1.  **Project Details View**: Displays comprehensive project summary, cash-flow, and invoice history with real-time updates.
2.  **Real-time System**: Uses WebSockets/SSE with polling for live updates on various events.
3.  **Enhanced Project Creation**: A 3-step workflow (Basic Info -> Company Selection -> Review BOQ & Create) with fields for Client/Architect details, PO number, project percentages, and detailed company info. Enhanced to include Client GST and Shipping Address.
4.  **BOQ Parsing**: Super Intelligent BOQ Parser with multiple strategies to handle diverse Excel formats, refined for header-based detection, flexible wording, and column variations.
5.  **UI Refinements**: Fixed modal z-index, enhanced project creation button, and refined BOQ table display.
6.  **Enhanced Invoice Creation UX**: Replaced simple alert with  showing details, PDF download, and Create Another options.
7.  **GST Management**: Project-level GST type selection (CGST+SGST/IGST), review, and locking after project creation. Manager/SuperAdmin can amend. GST breakdown in invoices.
8.  **Invoice Amendment Workflow**: Amend and View buttons in invoice history, amendment request workflow with Manager approval, and status management.
</product_requirements>

<key_technical_concepts>
-   **Full-stack**: React.js, FastAPI, MongoDB.
-   **Real-time**: WebSockets (socket.io-client, python-socketio), Polling.
-   **Data Processing**: OpenPyXL (Excel), ReportLab (PDF), Pydantic (data validation).
-   **UI/UX**: Tailwind CSS, React Router, Z-index management.
-   **Database**: MongoDB (using UUIDs instead of ObjectIDs, datetime handling).
-   **API Design**: FastAPI , environment variables ().
</key_technical_concepts>

<code_architecture>
The application uses a React frontend, FastAPI backend, and MongoDB database.

**Directory Structure:**



-   ****:
    -   **Importance**: Core API, business logic, database interaction, WebSocket server, BOQ parsing.
    -   **Changes Made**: Enhanced BOQ parsing logic (header-based, flexible column mapping, fixed summary row logic). Updated  model with GST fields (, , , , ). Updated  endpoint. Added  and  endpoints. Updated  model with GST breakdown (, , ). Modified invoice creation to use project's approved GST and to calculate CGST/SGST/IGST. Fixed  serialization. Implemented placeholder endpoints for Item Master, Search, Reports, PDF Processor, Admin, Enhanced, and Company Profile features to prevent 404s. Added backend endpoints for invoice amendment requests and approval. Updated  model with .
-   ** (New)**:
    -   **Importance**: Script for migrating existing projects to a default GST configuration.
    -   **Changes Made**: Created to set  to 'IGST' for projects without a defined GST type.
-   ****:
    -   **Importance**: Main application component, handles routing, layout, and real-time components.
    -   **Changes Made**: Integrated . Integrated  for improved invoice creation UX. Integrated  route and state. Added role-based filtering for GST Approval menu item. Added  state and  function. Fixed ESLint error ().
-   ****:
    -   **Importance**: Displays detailed project information.
    -   **Changes Made**: Added GST status indicator. Enhanced invoice history table with an Actions column, including View, Amend, and Download PDF buttons with corresponding handlers. Integrated  and  modals.
-   ****:
    -   **Importance**: Core component for creating invoices.
    -   **Changes Made**: Removed Total Qty header, renamed to Original Qty, increased font size and made it bold. Removed GST % dropdown and editing functionality; GST % is now display-only, inherited from the project.
-   ****:
    -   **Importance**: Manages WebSocket connection.
    -   **Changes Made**: Implemented  with robust connection management and polling fallback.
-   ****:
    -   **Importance**: Handles multi-step project creation.
    -   **Changes Made**: Refactored to a 3-step workflow. Added input fields for Architect Name/Address, Client Name/Address (replacing dropdown), Purchase Order Number, and project percentages. Added GST type selection (CGST+SGST/IGST). Fixed  error by extracting  array from backend response and adding null safety. Added Client GST Number (with validation) and Shipping Address fields, including Same as billing address checkbox.
-   ****:
    -   **Importance**: Reusable component to display invoice history.
    -   **Changes Made**: Created to display invoice details with professional formatting and color-coded values. (Note: The trajectory states New but then describes changes, implying it existed and was modified).
-   ** (New)**:
    -   **Importance**: Provides enhanced user feedback after invoice creation.
    -   **Changes Made**: Created to display comprehensive invoice details, PDF download option, and Create Another and Amend Invoice buttons.
-   ** (New)**:
    -   **Importance**: Interface for Manager/SuperAdmin to approve/reject project GST configurations.
    -   **Changes Made**: Created to manage pending GST approvals. Fixed Close button functionality and added ESC key support using .
-   ** (New)**:
    -   **Importance**: Interface for amending invoices and submitting amendment requests.
    -   **Changes Made**: Created to provide amendment options, capture amendment reasons, and submit requests for approval.
-   ** (New)**:
    -   **Importance**: Component to display invoice details.
    -   **Changes Made**: Created to view individual invoices.
-   ****:
    -   **Importance**: Displays various reports (GST Summary, Business Insights, Client Summary).
    -   **Changes Made**: Fixed  errors by aligning frontend data structure expectations with backend API responses (e.g.,  instead of ,  instead of ). Added null safety checks and improved error handling/loading states.
</code_architecture>

<pending_tasks>
-   **Implement Invoice Design**: Create a pixel-perfect invoice template exactly matching the provided screenshot.
-   **Invoice Design Customization**: Ensure only company address, contact number, and email ID are customizable in the invoice editor.
-   **Automate Invoice Calculations**: Implement logic for Rate × Amount, IGST, CGST, SGST, and Total calculations.
-   **PDF Export**: Ensure the new invoice design is exportable as PDF without layout issues.
-   **GST Breakdown in Design**: Incorporate GST breakdown examples (CGST/SGST/IGST) into the invoice design.
</pending_tasks>

<current_work>
Immediately prior to this summary, the AI engineer was tasked with implementing a pixel-perfect invoice design. This involves taking a provided screenshot of the desired invoice layout and a company logo, and creating a production-ready template.

The explicit requirements for this task are:
-   The invoice must render **exactly** as shown in the screenshot, maintaining layout, fonts, colors, alignments, spacing, and table styles.
-   The new company logo () must be placed in the specified position.
-   Only specific fields will be customizable in the invoice editor: **Company address, Company contact number, Company email ID**.
-   All other design elements (header, table formatting, item rows, signature area, totals section, terms & conditions section) must be **locked and non-editable**.
-   The table must properly support multiple rows of items while maintaining alignment.
-   Calculations (Rate × Amount, IGST, Total) must be automated.
-   The output must be exportable as PDF without layout breaking.
-   The design must accurately reflect GST breakdown examples, showing CGST, SGST, and IGST percentages.

The AI engineer has acknowledged this task and retrieved the provided screenshot and logo. The current work is at the very beginning of implementing this new invoice design and ensuring all its intricate details are captured and locked as requested.
</current_work>

<optional_next_step>
Start implementing the pixel-perfect invoice design for the frontend and integrate it with backend calculation logic.
</optional_next_step>
